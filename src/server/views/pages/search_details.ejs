<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>search details</title>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script>
      $(document).ready(function () {
        var url;
        var hostname = window.location.hostname;
        var planID = $('#planID').val();
        var userID = $('#userID').val();

        $('#addPlace').submit(function () {

          //toggle including port No. on dev/deployment
          if(hostname === 'localhost' || hostname === '127.0.0.1') {
            url = 'http://'+hostname+':3000/users/'+userID+'/plans/'+planID+'/new';
          } else {
            url = 'http://'+hostname+'/users/'+userID+'/plans/'+planID+'/new';
          }

          $.ajax({
            type : 'POST',
            url : url,
            data : {
              name : $('#name'),
              address : $('#address'),
              city : $('#city'),
              state : $('#state'),
              zipcode : $('#zipcode'),
              time : $('#time'),
            }
          });
        });
      });
    </script>
  </head>
  <body>
    <div>
      <ul>
      <li>
        <%= result.name %>
      </li>
      <li>
      <%= result.formatted_address %>
      </li>
      <li>
      <%= result.formatted_phone_number %>
      </li>
      <li>
      <%= result.rating %>
      </li>
    </ul>
      <% if(user_plans) { %>
      <form id="addPlace" action="#" method="GET">
        <select>
          <% user_plans.forEach((plan) => { %>
            <option id="planID" name="plan_id" value=<%plan.id%>>
              <%= plan.name %>
            </option>
          <% }); %>
        </select>
        <input type="hidden" name="name" id="name" value=<%= result.name %>>
        <input type="hidden" name="address" id="address" value=<%= result.address_components[0].long_name + ' ' + result.address_components[1].long_name %>
        <input type="hidden" name="city" id="city" value=<%= result.address_components[2].long_name %>>
        <input type="hidden" name="state" id="state" value=<%=result.address_components[3].long_name%>>
        <input type="hidden" name="zipcode" id="zipcode" value=<%=result.address_components[4].short_name%>>
        <select name="time" id="time">
          <option value="9:00 AM">9:00 AM</option>
          <option value="12:00 PM">12:00 PM</option>
          <option value="3:00 PM">3:00 PM</option>
          <option value="6:00 PM">6:00 PM</option>
          <option value="9:00 PM">9:00 PM</option>
        </select>
        <input type="hidden" id="userID" value="user.id">
        <input type="submit" value="add to plan">
      </form>
      <% } %>
      <!-- need route here -->
      <!-- <form action="index.html" method="POST">
        <fieldset>
          <legend>add to new plan</legend>
          <label for="plan_name">plan title</label>
          <input type="text" name="plan_name">
          <input type="hidden" name="place_name" value=<%= result.name %>>
          <input type="hidden" name="place_address" value=<%= result.address_components[0].long_name + ' ' + result.address_components[1].long_name %>
          <input type="hidden" name="place_city" value=<%= result.address_components[2].long_name %>>
          <input type="hidden" name="place_state" value=<%=result.address_components[3].long_name%>>
          <input type="hidden" name="place_zipcode" value=<%=result.address_components[4].short_name%>>
          <input type="submit" value="add to plan">
        </fieldset>
      </form> -->
      <h3>reviews:</h3>
      <hr>
      <% result.reviews.forEach((review) => { %>
        <div class="review">
        <% if (result.reviews.indexOf(review) < 5) { %>
          <li>
            author:
            <%= review.author_name %>
          </li>
          <li>
            photo url:
            <%= review.profile_photo_url %>
          </li>
          <li>
            rating
            <%= review.rating %>
          </li>
          <li>
            review:
            <%= review.text %>
          </li>
          <li>
            posted:
            <%= review.time %>
          </li>
        <% } %>
        </div>
        <hr>
      <% }); %>
    </div>
  </body>
</html>
